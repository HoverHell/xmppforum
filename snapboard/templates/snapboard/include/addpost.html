{% if not thr.closed and not page_next %}
    {% if user.is_authenticated %}
    <!-- div style="border: 1px solid #ccc; padding: 5px; background: #efe" -->
    <p>
    <span style="float:right;"><a href="#snap_markdown_guide" onclick="toggle('snap_markdown_guide', 'block');">Pretty-print guide</a></span>
    <b>Got something to say?</b>
    </p>
    {% include "snapboard/include/markdown_guide.html" %}
    <form id="add_post_div" action="" method="POST" enctype="text/plain">
        <script type="text/javascript" src="{{ SNAP_MEDIA_PREFIX }}/js/yui/event-min.js"></script>
        <script type="text/javascript" src="{{ SNAP_MEDIA_PREFIX }}/js/yui/autocomplete-min.js"></script>
        <p>{{ postform.post }} {{ postform.post.errors }}</p>
        <p id="autocomplete_p">
            <!-- span style="float:right;"><b>I need more space!</b></span -->
            <a href="#add_post_div" onclick="toggle('autocomplete_input', 'block'); toggle('autocomplete_p', 'inline');">set private recipients (optional)</a>
        </p>
        <div id="autocomplete_input" style="display:none">
            <p>{{ postform.private }}</p>
            <div id="autocomplete_div"></div>
            <script type="text/javascript"><!--
                dataSource = new YAHOO.widget.DS_XHR("{{ SNAP_PREFIX }}/rpc/user_lookup/", ["ResultSet.Result","name","id"]);
                autoComp = new YAHOO.widget.AutoComplete("id_private","autocomplete_div",dataSource);
                autoComp.delimChar = ","; 
                autoComp.typeAhead = true;
                autoComp.highlightClassName = "highlight";
                // -->
            </script>
        </div>
        {% if postform.private.errors %}
        {{ postform.private.errors }}
        {% endif %}

        <p>
        <input type="submit" value="Post" />
        <input type="button" value="Preview" onclick="preview('add_post_div')" />
        </p>
    </form>
    <div style="border: 1px solid #ccc; display: none;">
        <p><b>Post Preview:</b></p>
        <div id="snap_preview_addpost" class="post_text">
        </div>
    </div>
    {% else %}
    <p>You need to <a href="{{ SNAP_PREFIX }}/signin/?next={{ request.path|urlencode }}#add_post_div">sign in</a> to post messages.</p>
    {% endif %}
{% endif %}
{% if thr.closed %}
    <p>This discussion has been closed by the staff.  You can no longer add posts.</p>
{% endif %}

<!--
vim: ai ts=4 sts=4 et sw=4
-->
