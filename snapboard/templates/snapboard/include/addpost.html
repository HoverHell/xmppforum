{% load i18n %}
{% spaceless %}
{% if not thr.closed %}{# and not page_next #}
    {% if user.is_authenticated %}
    {% ifequal SNAP_POST_FILTER "markdown" %}
        <p><span style="float:right;"><a href="#snap_markdown_guide" onclick="toggle('snap_markdown_guide', 'block');">{% trans "Pretty-print guide" %}</a></span></p>
        {% include "snapboard/include/markdown_guide.html" %}
    {% endifequal %}
    <form id="add_post_div" action="{% url snapboard_post_reply parent_post.id %}" method="POST">
        <a name="post_form"></a>
        <script type="text/javascript" src="{{ SNAP_MEDIA_PREFIX }}/js/yui/autocomplete-min.js"></script>
        <div id="toolbar" style="">
            {% ifequal SNAP_POST_FILTER "markdown" %}
                <button onclick="return surround('**');"><b>{% trans "B" %}</b></button>
                <button onclick="return surround('_');"><i>{% trans "i" %}</i></button>
                <button onclick="return do_prefix('> ');"><span>{% trans "quote" %}</span></button>
                <button onclick="return do_prefix('    ');"><span>{% trans "code" %}</span></button>
                <button onclick="return do_prefix('* ');"><span>{% trans "list" %}</span></button>
                <button onclick="return insert_img();"><span>{% trans "img" %}</span></button>
                <button onclick="return insert_link();"><u>{% trans "link" %}</u></button>
            {% else %}{% ifequal SNAP_POST_FILTER "bbcode" %}
                <button onclick="return surround('[b]','[/b]');"><b>{% trans "B" %}</b></button>
                <button onclick="return surround('[i]','[/i]');"><i>{% trans "i" %}</i></button>
                <button onclick="return surround('[quote]','[/quote]');"><span>{% trans "quote" %}</span></button>
                <button onclick="return surround('[code]','[/code]');"><span>{% trans "code" %}</span></button>
                <button onclick="return do_prefix('[*]');"><span>{% trans "list" %}</span></button>
                <button onclick="return insert_img();"><span>{% trans "img" %}</span></button>
                <button onclick="return insert_link();"><u>{% trans "link" %}</u></button>
            {% endifequal %}{% endifequal %}
        </div>
        {{ postform.as_p }}
        <p>{{ postform.errors }}</p>
        <div class="form_controls">
        <input type="submit" value="{% trans "Post" %}" />
        <input type="button" value="{% trans "Preview" %}" onclick="preview('add_post_div')" />
        </div>
    </form>
    <div style="border: 1px solid #ccc; display: none;">
        <p><b>{% trans "Post Preview:" %}</b></p>
        <div id="snap_preview_addpost" class="post_text">
        </div>
    </div>
    {% else %}
    <p>{% blocktrans with request.path|urlencode as reqpath %}
        You need to <a href="{{ LOGIN_URL }}?next={{ reqpath }}#add_post_div">sign in</a> to post messages.
    {% endblocktrans %}</p>
    {% endif %}
{% endif %}
{% if thr.closed %}
    <p>{% trans "This discussion has been closed by the staff.  You can no longer add posts." %}</p>
{% endif %}
{% endspaceless %}
