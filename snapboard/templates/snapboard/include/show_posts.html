{% load i18n %}
{% load extras %}
{% load pagination_tags %}

{% load cache %}

<div id="stp" class="tp">
{% if subtopic %}
  <p>{% trans "You are viewing part of the topic" %}</p>
{% else %}
{% with top_post as post %}
  <div id="sp{{ post.id }}">
      <div id="prf{{ post.id }}" class="rm"></div>
      <div class="ph">
        {% avatar_opt post.user %}
        <span class="mr">
          <span class="un">[{{ post.user }}]</span>
          {% if user.is_authenticated  %}
            <a href="{% url snapboard_post_reply post.id %}" onclick="return t_r('{{ post.id }}');">{% trans "reply" %}</a>
          {% endif %}
          {% if not user.really_anonymous %}{% ifequal post.user_id user.id  %}
            <a href="{% url snapboard_edit_post post.id %}?next={{ request.get_full_path|urlencode }}" onclick="return t_e('{{ post.id }}');">{% trans "edit" %}</a>
          {% endifequal %}{% endif %}
          {% if user.is_staff %}
            <a id="c{{ post.id }}" href="" onclick="s_c('{{ post.id }}');">{{ post.censor|yesno:_("uncensor,censor") }}</a>
          {% endif %}
          {% if user.is_authenticated and not post.freespeech and not user.really_anonymous %}
            <a id="a{{ post.id }}" href="" onclick="s_a('{{ post.id }}');">{% trans "abuse" %}</a>
          {% endif %}
          {% if post.previous_id %}
            <span id="prl{{ post.id }}"><a href="{% url snapboard_show_revisions post.id %}">{% trans "history" %}</a></span>
          {% endif %}
          <span class="ti">{% reltime post.date %}</span>
        </span>
      </div>
      <div id="spv{{ post.id }}" class="pv">
        <div class="pt" id="spt{{ post.id }}">{{ post.texth|safe }}</div>
        {% ifequal post.user_id user.id %}
          <div style="display:none" id="spe{{ post.id }}"></div>
        {% endifequal %}
        <div style="display:none" id="spr{{ post.id }}" ></div>
      </div>
  </div>
{% endwith %}
{% endif %}
</div>


{# autopaginate post_list user_settings.ppp #}

<div class="pm{% if subtopic %} st{% endif %}">{% paginate %}
{% if top_post.nav %}
{% if top_post.n_left %}<a href="{% url snapboard_thread_post top_post.n_left.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">←</a>{% else %}←{% endif %}
{% if top_post.n_down %}<a href="{% url snapboard_thread_post top_post.n_down.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">↓</a>{% else %}↓{% endif %}
{% if top_post.n_up %}<a href="{% url snapboard_thread_post top_post.n_up.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">↑</a>{% else %}↑{% endif %}
{% if top_post.n_right %}<a href="{% url snapboard_thread_post top_post.n_right.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">→</a>{% else %}→{% endif %}
{% endif %}
</div>
<div class="threads_wrap">
{% for post, post_info in post_list %}
  {% if not post_info.open %}</td></tr></table>{% endif %}
  <table id="sp{{ post.id }}" class="sp{% if not post.is_flat %}{% ifequal post.depth listdepth %} rp{% else %} lm{% if post.next_sibling %} pn{% endif %}{% endifequal %}{% endif %}">
  <tr>
    {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}
      <td class="pp"></td></tr><tr>
      <td class="{% if not post.next_sibling %}tc{% else %}et{% endif %}"><div></div></td>
    {% endifnotequal %}{% endif %}
    <td>
      {% if post.censor and not user.is_staff %}
        <div id="spv{{ post.id }}" class="pv pc{% if post.is_flat %} f{% else %} nf{% endif %}"><div id="spt{{ post.id }}" class="pt">Censored post #{{ post.id_form_a }}.</div></div>
      {% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_header.html" %}
        {% else %}
          {% include "snapboard/include/post_short_header.html" %}
        {% endif %}
      {% endif %}
          </td></tr><tr>
          {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}{% if post.next_sibling %}
            <td class="tl"></td>
          {% else %}
            <td></td>
          {% endif %}{% endifnotequal %}{% endif %}
          <td>
      {% if post.censor and not user.is_staff %}{% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_body.html" %}
        {% else %}
          {% include "snapboard/include/post_short_body.html" %}
        {% endif %}
      {% endif %}{# post.censor and not user.is_staff  else #}
  {% for close in post_info.close %}</td></tr></table>{% endfor %} 
{% endfor %}
</div>
<div class="pm">{% paginate %}</div>
