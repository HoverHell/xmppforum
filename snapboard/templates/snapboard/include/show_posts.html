{% load i18n %}
{% load extras %}
{% load pagination_tags %}

{% load cache %}

<div class="tp">
{% if subtopic %}
  <p>{% trans "You are viewing part of the topic" %}</p>
{% else %}
{% with top_post as post %}
  <div id="sp{{ post.id }}">
      <div class="ph"><div>
        {% avatar_opt post.user %}
        <span class="un">{{ post.user }}</span>
        {% if user.is_authenticated %}
          {% if not user.really_anonymous %}{% ifequal post.user_id user.id %}
            <a href="{% url snapboard_edit_post post.id %}?next={{ request.get_full_path|urlencode }}#sp{{ post.id }}" onclick="return t_e('{{ post.id }}')">{% trans "edit" %}</a>
          {% endifequal %}{% endif %}
          <a href="{% url snapboard_post_reply post.id %}" onclick="return t_r('{{ post.id }}');">{% trans "reply" %}</a>
          {% if not user.really_anonymous %}<a target="_blank" id="w{{ post.id }}" href="{% url snapboard_watch_post post.id %}" onclick="s_w('{{ post.id }}'); return false;">{% trans "watch" %}</a>{% endif %}
          {% if not post.freespeech and not user.really_anonymous and not user.is_staff %}<a id="a{{ post.id }}" href="" onclick="s_a('{{ post.id }}');">{% trans "abuse" %}</a>{% endif %}
          {% if user.is_staff %}<a id="c{{ post.id }}" href="" onclick="s_c('{{ post.id }}');">{{ post.censor|yesno:_("uncensor,censor") }}</a>{% endif %}
        {% endif %}
        {% if post.previous_id %}<a href="{% url snapboard_show_revisions post.id %}">{% trans "history" %}</a>{% endif %}
        <span class="ti">{% reltime post.date %}</span>
      </div></div>
      <div id="spv{{ post.id }}" class="pv">
        <div id="prf{{ post.id }}" class="rm"></div>
        <div class="pt" id="spt{{ post.id }}">{{ post.texth|safe }}</div>
        {% ifequal post.user_id user.id %}
          <div style="display:none" id="spe{{ post.id }}"></div>
        {% endifequal %}
        <div style="display:none" id="spr{{ post.id }}" ></div>
      </div>
  </div>
{% endwith %}
{% endif %}
</div>


{# autopaginate post_list user_settings.ppp #}

<div class="pm{% if subtopic %} st{% endif %}">{% paginate %}
{% if top_post.nav %}
{% if top_post.n_left %}<a href="{% url snapboard_thread_post top_post.n_left.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">←</a>{% else %}←{% endif %}
{% if top_post.n_down %}<a href="{% url snapboard_thread_post top_post.n_down.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">↓</a>{% else %}↓{% endif %}
{% if top_post.n_up %}<a href="{% url snapboard_thread_post top_post.n_up.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">↑</a>{% else %}↑{% endif %}
{% if top_post.n_right %}<a href="{% url snapboard_thread_post top_post.n_right.id %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">→</a>{% else %}→{% endif %}
{% endif %}
</div>
<div class="tw">

{% for post, post_info in post_list %}
  {% if not post_info.open %}</div></div>{% endif %}
  <div id="sp{{ post.id }}" {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}title="1"{% if post.next_sibling %}class="np{% if post.censor %}{% if not user.is_staff %} pc{% else %} apc{% endif %}{% else %}{% ifnotequal post.abuse 0 %}{% if not user.is_staff %} pr{% else %} apr{% endif %}{% endifnotequal %}{% endif %}"{% else %}class="ep{% if post.censor %}{% if not user.is_staff %} pc{% else %} apc{% endif %}{% else %}{% ifnotequal post.abuse 0 %}{% if not user.is_staff %} pr{% else %} apr{% endif %}{% endifnotequal %}{% endif %}"{% endif %}{% else %}{% if post.censor %}{% if not user.is_staff %}class="pc"{% else %}class="apc"{% endif %}{% else %}{% ifnotequal post.abuse 0 %}{% if not user.is_staff %}class="pr"{% else %}class="apr"{% endif %}{% endifnotequal %}{% endif %}{% endifnotequal %}{% else %}class="fp{% if post.censor %}{% if not user.is_staff %} pc{% else %} apc{% endif %}{% else %}{% ifnotequal post.abuse 0 %}{% if not user.is_staff %} pr{% else %} apr{% endif %}{% endifnotequal %}{% endif %}"{% endif %}>
    {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}{% if not post.next_sibling %}<div></div>{% endif %} {% endifnotequal %}{% endif %}
    {% if post.is_flat %}<div>{% else %}{% ifequal post.depth listdepth %}<div>{% else %}<div class="hw"><div class="tc"></div>{% endifequal %}{% endif %}
      {% if post.censor and not user.is_staff %}
        <div id="spv{{ post.id }}" class="pv"><div id="spt{{ post.id }}" class="pt">Censored post <a href="{% url snapboard_thread_post post.id %}">#{{ post.id_form_a }}</a>.</div></div>
      {% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_header.html" %}
        {% else %}
          {% include "snapboard/include/post_short_header.html" %}
        {% endif %}
      {% endif %}
    </div>
    {% if post.is_flat %}<div>{% else %}{% ifequal post.depth listdepth %}<div>{% else %}<div class="pp">{% endifequal %}{% endif %}
      {% if post.censor and not user.is_staff %}{% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_body.html" %}
        {% else %}
          {% include "snapboard/include/post_short_body.html" %}
        {% endif %}
      {% endif %}{# post.censor and not user.is_staff  else #}
  {% for close in post_info.close %}</div></div>{% endfor %} 
{% endfor %}

</div>
<div class="pm">{% paginate %}</div>
