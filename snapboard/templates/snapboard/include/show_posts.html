{% load i18n %}
{% load extras %}
{% load avatar_tags %}
{% load pagination_tags %}

{% load cache %}

<div id="stp" class="tp">
{% if subtopic %}
  <p>{% trans "You are viewing part of the topic" %}</p>
{% else %}
  <div id="sp{{ top_post.id }}">
      <div id="prf{{ top_post.id }}" class="rm"></div>
      <div class="ph">
        <img src="{% avatar_url top_post.user %}" class="up" />
        <span class="mr">
          <span class="un">[{{ top_post.user }}]</span>
          {% if user.is_authenticated  %}
            <a href="{% url snapboard_post_reply top_post.id %}" onclick="return t_r('{{ top_post.id }}');">{% trans "reply" %}</a>
          {% endif %}
          {% if not user.really_anonymous %}{% ifequal top_post.user_id user.id  %}
            <a href="{% url snapboard_edit_post top_post.id %}?next={{ request.get_full_path|urlencode }}" onclick="return t_e('{{ top_post.id }}');">{% trans "edit" %}</a>
          {% endifequal %}{% endif %}
          {% if user.is_staff %}
            <a id="c{{ top_post.id }}" href="" onclick="s_c('{{ top_post.id }}');">{{ top_post.censor|yesno:_("uncensor,censor") }}</a>
          {% endif %}
          {% if user.is_authenticated and not top_post.freespeech and not user.really_anonymous %}
            <a id="a{{ top_post.id }}" href="" onclick="s_a('{{ top_post.id }}');">{% trans "abuse" %}</a>
          {% endif %}
          {% if post.previous_id %}
            <span id="prl{{ post.id }}"><a href="{% url snapboard_show_revisions post.id %}">{% trans "history" %}</a></span>
          {% endif %}
          {% if top_post.private.all %}{% trans "to" %} {% for rec in top_post.private.all %}{{ rec }}{% if not forloop.last %},{% endif %}{% endfor %}{% endif %}
          <span class="ti">{% reltime top_post.date %}</span>
        </span>
      </div>
      <div id="spv{{ top_post.id }}" class="pv">
        <div class="pt" id="spt{{ top_post.id }}">{{ top_post.text|striptags|render_post|safe }}</div>
        {% ifequal top_post.user_id user.id %}
          <div style="display:none" id="spe{{ top_post.id }}"></div>
        {% endifequal %}
        <div style="display:none" id="spr{{ top_post.id }}" ></div>
      </div>
  </div>
{% endif %}
</div>


{# autopaginate post_list user_settings.ppp #}

<div class="pmenu">{% paginate %}</div>
<div class="threads_wrap">
{% for post, post_info in post_list %}
  {% if not post_info.open %}</td></tr></table>{% endif %}
  <table id="sp{{ post.id }}" class="sp{% if not post.is_flat %}{% ifequal post.depth listdepth %} rp{% else %} lm{% if post.next_sibling %} pn{% endif %}{% endifequal %}{% endif %}">
  <tr>
    {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}
      <td class="pp"></td></tr><tr>
      <td class="{% if not post.next_sibling %}tc{% else %}et{% endif %}"><div></div></td>
    {% endifnotequal %}{% endif %}
    <td>
      {% if post.censor and not user.is_staff %}
        <div id="spv{{ post.id }}" class="pv pc{% if post.is_flat %} f{% else %} nf{% endif %}"><div id="spt{{ post.id }}" class="pt">Censored post #{{ post.id_form_a }}.</div></div>
      {% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_header.html" %}
        {% else %}
          {% include "snapboard/include/post_short_header.html" %}
        {% endif %}
      {% endif %}
          </td></tr><tr>
          {% if not post.is_flat %}{% ifnotequal post.depth listdepth %}{% if post.next_sibling %}
            <td class="tl"></td>
          {% else %}
            <td></td>
          {% endif %}{% endifnotequal %}{% endif %}
          <td>
      {% if post.censor and not user.is_staff %}{% else %}
        {% if post.depth != maxdepth or post.numanswers = 1 %}
          {% include "snapboard/include/post_full_body.html" %}
        {% else %}
          {% include "snapboard/include/post_short_body.html" %}
        {% endif %}
      {% endif %}{# post.censor and not user.is_staff  else #}
  {% for close in post_info.close %}</td></tr></table>{% endfor %} 
{% endfor %}
</div>
<div class="pmenu">{% paginate %}</div>
